# PJT5 - 혜원K README

- 과정 :
    - 팀원 간 구현 기능 상의 및 테이블 구조 설계
    - 역할 분담 이후 맡은 일 완료

- 맡은 역할
    - erd 설계
    - database script 작성
    - 팀 [README.md](http://README.md) 작성

- 사용한 툴
    - MySQL Workbench
    - notion
    - git

- PJT 과정에서 느낀점 및 궁금점
    1. Q. user table에서 사용자가 지정한 아이디(id)는 unique값이기 때문에 해당 값으로 PK를 두어도 될 텐데 왜 추가로 user_id를 넣는 것일까?
        
        A. 
        
        1. 변경 가능성 : 사용자가 지정한 아이디는 이후 수정될 수 있다. 반면 user_id는 시스템에서 관리하는 값으로 변경할 일이 없어 데이터의 일관성을 유지하기가 더 쉽다. 
        2. 성능 향상 : 우리 조는 시스템이 관리할 user_id를 INT로 만들었고, 일반적으로 사용자가 지정하는 id는 VARCHAR의 문자형이다. 이후 인덱스로 관리 측면에서도 정수 자료형이 편리할 것이라는 생각이 들었다. 
        3. 보안 측면 : 외부에 공개될 수 있는 사용자가 지정한 아이디 대신 내부적으로 user_id와 같은 별도의 식별자를 사용함으로써 민감한 정보를 보호할 수 있다. 
        
    2. 우리는 유저의 탈퇴나 상태를 담기 위해 int 자료형을 활용했다. 탈퇴 이후 곧바로 해당 데이터를 지우는 것이 아니라 잠시 flag 값을 전환한 뒤 일정 기간 이후 해당 데이터를 삭제하고자 했다. 혹여나 탈퇴한 유저가 본인의 데이터를 필요로 하는 경우가 있을 수도 있고, 탈퇴를 철회하는 경우가 있을 것이라고 생각했다. 이외에도 유저가 휴면 상태로 전환될 수도 있고, 사이트의 규정을 지키지 않아 정지가 된 회원의 상태도 존재할 것이라고 생각했기 때문이다. 
    
    1. Q. 탈퇴 후 3년까지 유저 정보를 저장하고, 이후에 데이터베이스에서 지우려면 어떤 과정을 거쳐야 할까?
        
        A. 팀끼리 고민해 본 결과 탈퇴 회원을 관리하는 테이블을 분리하자는 의견이 나왔다. 해당 테이블에 탈퇴 시점을 넣어두고, 상태를 관리한다. 서치 해 본 결과 팀에서 생각해 낸 아이디어보단 일반적으로 자동 삭제 시스템을 사용한다고 한다. 일정 보존 기간이 끝나면 자동으로 데이터를 삭제하는 스케줄러 또는 백그라운드 작업을 구현한다고 한다. cron job이나 데이터베이스 트리거를 통해 위 과정을 자동화할 수 있다고 한다. 다음 번에 사이트를 제작할 때 해당 기능을 구현하여 완성도를 높이고 싶다.
        
    
    1. 유저가 특정 동영상에 대한 리뷰를 쓰고 탈퇴할 경우와 리뷰를 달았지만 해당 영상이 삭제 되는 경우에 대해 생각해 보았다. 우리 조는 탈퇴할 경우 유저의 데이터를 바로 지우는 것이 아니라 데이터를 가리고, 일정 시간이 지난 뒤 데이터를 삭제하자는 결론을 내렸다. 또한 리뷰에 대한 영상이 사라져도 리뷰를 단 유저가 자신이 단 리뷰 목록 조회 시 해당 리뷰가 보일 수 있도록 하기로 했다. 
    2. review 테이블의 review_id가 아닌 video_id와 user_id를 복합키로 하여 review 테이블의 PK로 두는 방안에 대해 고민해보았다. 그러나 한 명의 유저가 하나의 영상에 여러 리뷰를 달 경우 video_id와 user_id는 동일하지만 모두 다른 리뷰이기 때문에 해당 복합키는 unique하지 않다는 결론이 나왔다. 따라서 기본키의 조건을 모두 갖춘 review_id를 사용해야 한다. 또한 유저가 자신이 쓴 리뷰 목록을 조회할 때 보통은 해당 리뷰를 작성한 시간 순으로 정렬이 되어 나오는데 이 때 해당 리뷰가 작성된 시간을 필드 값으로 하여 조회할 수도 있지만, review_id를 auto_increment하게 만들면 PK를 기준으로 정렬해도 시간순으로 조회할 수 있다는 것을 알았다.
    3. 이후 리뷰에 사진을 첨부할 수 있는 기능을 구현하게 되면 리뷰의 사진들을 어떻게 관리해야 할까? 사진 한 장이라면 이를 스토리지 서비스에 올린 뒤 파일 서버 URL을 리뷰 테이블에 필드로 저장하면 되지만, 하나의 리뷰에 여러 개의 사진을 올릴 수 있을 때는 사진 테이블을 별도로 분리해야 된다고 생각한다. 
    4. 찜 기능을 위한 테이블을 설계하며 사용 유저가 매우 많은 사이트의 경우 ‘좋아요’와 같은 기능을 어떻게 구현하는지가 궁금했다. 유명인이 게시글을 올리면 1분도 되지 않아 수많은 사용자가 해당 글에 ‘좋아요’와 같은 순간적인 반응을 보이는데 이러한 데이터 업데이트를 어떤 주기로 업데이트를 하는지 궁금했다. 
        
        A. 서치 결과 이를 바로 데이터베이스에 기록하는 대신 다양한 방식으로 데이터베이스 업데이트 주기를 늦춰 서버의 부하를 줄일 수 있다는 것을 알게 되었다. 
        
        1. 비동기 처리 : 실시간으로 데이터의 변화를 데이터베이스에 업데이트하는 것이 아니라 요청을 큐에 저장한 후 주기적으로 큐에서 데이터를 처리하는 방식이다. 사용자가 ‘좋아요’를 누를 경우 클라이언트의 화면에서는 즉각 해당 ‘좋아요’수를 업데이트하지만, 이 수치는 잠시 동안 캐시나 클라이언트 측에서만 반영한 후 데이터베이스에 업데이트한다고 한다. 
        2. 캐시 사용 : 인메모리 캐시 시스템을 사용하여 ‘좋아요’와 같은 빈번한 업데이트를 캐시에 먼저 기록한 후, 일정 시간 동안 캐시에서 데이터를 제공하고, 일정 시간이 지나면 데이터베이스에 업데이트 한다.
        3. 배치 프로세싱 (일괄 처리) : 일정 시간 동안 발생한 요청을 모아서 한 번에 처리하는 방식이라고 한다. 이 경우 일정 시간동안 발생한 요청을 어떤 방식으로 저장했다가 처리하는지 궁금해졌다.
        4. Sharding (데이터 분할) : 유저가 매우 많을 때는 데이터베이스를 샤딩하여 데이터를 분산 처리한다고 한다. 유저 데이터를 여러 개의 물리적 서버에 분산 저장하여, 하나의 서버에 모든 부하가 몰리지 않도록 한다고 한다.
